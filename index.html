<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Guestbook</title>
</head>
<body>
  <h1>Guestbook</h1>

  <p>Frontend version: <b>1.0.0</b></p>
  <p id="backend"></p>

  <input id="author" placeholder="Your name"><br>
  <textarea id="text" placeholder="Message"></textarea><br>
  <button onclick="send()">Send</button>

  <ul id="messages"></ul>

<script>
const API = "https://d5d6rpnsp29i770d0pfk.kf69zffa.apigw.yandexcloud.net";

async function health() {
  const r = await fetch(API + "/health");
  const d = await r.json();
  document.getElementById("backend").innerText =
    `Backend v${d.backend_version}, instance ${d.instance_id}`;
}

async function load() {
  const r = await fetch(API + "/messages");
  const msgs = await r.json();
  const ul = document.getElementById("messages");
  ul.innerHTML = "";
  msgs.forEach(m => {
    const li = document.createElement("li");
    li.innerText = `${m.author}: ${m.text}`;
    ul.appendChild(li);
  });
}

async function send() {
  await fetch(API + "/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      author: author.value,
      text: text.value
    })
  });
  load();
}

health();
load();
</script>
</body>
</html>
